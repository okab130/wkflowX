# Django 業務ワークフローシステム 設計書

## 1. システム概要
製造業・建設業向けの作業申請・受付・承認フローを管理するDjangoアプリケーション

## 1.1 業務要件
- 取引先企業が各種作業・持込申請を作成・提出
- 受付担当者が申請内容を確認・受理
- 承認者が最終的に承認/却下を判断
- メール通知機能により関係者へ自動通知
- 添付ファイルで図面・仕様書等のドキュメントを添付可能

## 2. データモデル設計

### 2.1 User（ユーザー）
- Django標準のUser拡張
- ユーザー種別: 取引先、受付担当、承認者、管理者
- 所属企業・部署情報

### 2.2 Application（申請）
- 申請の基本情報
- フィールド:
  - 申請番号（自動採番）
  - 申請種別（作業/工事/工具持込/制限エリア立入/制限エリア工具持込）
  - 申請タイトル
  - 申請内容（詳細）
  - 申請者（取引先ユーザー）
  - 申請者企業名
  - 作業予定日/期間
  - 作業場所
  - 人数
  - ステータス（下書き/申請中/受付済/承認済/却下/差し戻し）
  - 作成日時/更新日時/提出日時

### 2.3 WorkflowStep（ワークフローステップ）
- 申請の進行状況を記録
- フィールド:
  - 申請
  - ステップ種別（申請/受付/承認）
  - 処理者
  - ステータス（未処理/処理中/完了/却下）
  - コメント
  - 処理日時

### 2.4 Comment（コメント）
- 各段階でのやり取り
- フィールド:
  - 申請
  - コメント者
  - コメント内容
  - 作成日時

### 2.5 Attachment（添付ファイル）
- 申請に関連するファイル
- フィールド:
  - 申請
  - ファイル
  - ファイル名
  - アップロード日時

## 3. URL設計

```
/workflow/
  - / : ダッシュボード（申請一覧）
  - /create/ : 新規申請作成
  - /<int:pk>/ : 申請詳細
  - /<int:pk>/edit/ : 申請編集
  - /<int:pk>/submit/ : 申請提出
  - /<int:pk>/receive/ : 受付処理
  - /<int:pk>/approve/ : 承認処理
  - /<int:pk>/reject/ : 却下処理
  - /<int:pk>/comment/ : コメント追加
  - /my-applications/ : 自分の申請一覧
  - /pending-receive/ : 受付待ち一覧
  - /pending-approve/ : 承認待ち一覧
```

## 4. ビュー設計

### 4.1 ダッシュボード（ListView）
- ユーザー種別に応じた申請一覧表示

### 4.2 申請作成（CreateView）
- フォーム入力
- 下書き保存/申請提出

### 4.3 申請詳細（DetailView）
- 申請内容表示
- ワークフロー進行状況
- コメント履歴
- アクションボタン（ステータスに応じて）

### 4.4 受付処理（UpdateView）
- 受付担当者が内容確認
- 受理/差し戻し

### 4.5 承認処理（UpdateView）
- 承認者が最終判断
- 承認/却下

## 5. 画面一覧

1. ダッシュボード
2. 申請作成フォーム
3. 申請詳細画面
4. 申請編集画面
5. 受付待ち一覧
6. 承認待ち一覧
7. 自分の申請一覧
8. 申請履歴

## 6. 権限設計

- 取引先: 自社の申請の作成・編集・閲覧・再申請
- 受付担当: 全申請の閲覧、受付処理、差し戻し
- 承認者: 受付済申請の閲覧、承認/却下
- 管理者: 全機能アクセス、ユーザー管理、マスタ管理

## 7. ステータス遷移

```
下書き → 申請中 → 受付済 → 承認済
            ↓         ↓
          却下      差し戻し → 再申請 → 申請中
```

## 8. メール通知タイミング

- 申請提出時 → 受付担当へ通知
- 受付完了時 → 承認者へ通知、申請者へ受付完了通知
- 承認時 → 申請者へ承認通知
- 却下時 → 申請者へ却下理由通知
- 差し戻し時 → 申請者へ修正依頼通知

## 9. 申請種別ごとの必須項目

### 作業申請
- 作業内容、作業予定日、作業場所、作業人数

### 工事申請
- 工事内容、工事期間、工事場所、施工業者、工事人数、添付ファイル（図面必須）

### 工具持込申請
- 持込工具リスト、使用目的、使用期間、返却予定日

### 制限エリア立入申請
- 立入エリア、立入目的、立入予定日時、立入者リスト、同行者

### 制限エリア工具持込申請
- 立入エリア、持込工具リスト、使用目的、使用期間、立入者リスト

## 10. 実装の優先順位

Phase 1: 基本機能（MVP）
- ユーザー認証・権限管理
- 5種類の申請モデル定義
- 申請CRUD（作成・閲覧・編集・削除）
- 基本的なワークフロー（申請→受付→承認）
- 添付ファイル機能

Phase 2: 業務機能
- コメント機能
- メール通知機能（全タイミング）
- 差し戻し・再申請フロー
- 検索・フィルタリング
- 申請履歴表示

Phase 3: 高度な機能
- ダッシュボード（統計、グラフ）
- エクスポート機能（Excel/PDF）
- 申請テンプレート機能
- カレンダー表示（作業予定）
- レポート・分析機能
